{% extends 'base.html.twig' %}

{% block title %}Accueil{% if type == 'customer' %}Clients{% elseif type == 'supplier' %}Fournisseurs{% endif %}{% endblock %}

{% block stylesheets %}

<!-- DataTables -->
<link href="/plugins/datatables/dataTables.bootstrap4.min.css" rel="stylesheet" type="text/css" />
<link href="/plugins/datatables/buttons.bootstrap4.min.css" rel="stylesheet" type="text/css" />
<!-- Responsive datatable examples -->
<link href="/plugins/datatables/responsive.bootstrap4.min.css" rel="stylesheet" type="text/css" />  

{% endblock %}

{% block pageTitle %}
<h4 class="page-title mb-2"><i class="mdi mdi-account-multiple mr-2"></i>{% if type == 'customer' %}Clients{% elseif type == 'supplier' %}Fournisseurs{% endif %}</h4>  
{% endblock %}

{% block breadcrumb %}
    <div class="">
        <ol class="breadcrumb">
            <li class="breadcrumb-item active">Accueil</li>
            <li class="breadcrumb-item active">{% if type == 'customer' %}Clients{% elseif type == 'supplier' %}Fournisseurs{% endif %}</li>
        </ol>
    </div>
{% endblock %}

{% block body %}
{# {{ dump('iconStock = ' ~ iconStock) }} #}
    {#<div class="row">
        <div class="col-md-12 col-lg-12">
            <div class="card">
                <div class="card-body">

                    {% if customers|length > 0 %}
                    <h4 class="mt-0 header-title">List of Customers</h4>
                    <div class="mt-2 mr-5 text-right">
                        <a href="{{path('customer_create')}}"  class="btn btn-info btn-lg rounded " data-toggle="tooltip" data-placement="top" title="Add New Customer"><i class="fa fa-plus-circle mr-2"></i> <i class="mdi mdi-account-multiple"></i></a>
                    </div>
                    <div class="row mt-4">
                        <div class="col-sm-12">
                            <div class="card-box table-responsive">
                                <table id="datatable-responsive1" class="table dt-responsive nowrap gridTabReport" cellspacing="0" width="100%">
                                    <thead>
                                        <tr class="text-center">
                                            <th>#</th>
                                            <th>Name</th>
                                            <th>Tel</th>
                                            <th>Address</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for customer in customers %}
                                        <tr class="text-center">
                                            <td>{{customer.id}}</td>
                                            <td>{{customer.fullName}}</td>
                                            <td>{{customer.phoneNumber}}</td>
                                            <td>{{customer.address}}</td>
                                            <td>
                                                <a href="{{path('customer_edit', {'id':customer.id})}}"  class="btn btn-info btn-xs rounded" data-toggle="tooltip" data-placement="top" title="Modify Customer"><i class="far fa-edit"></i> </a>
                                                <a href="#" class="btn btn-primary btn-xs rounded" data-toggle="tooltip" data-placement="top" title="Place Order"><i class="mdi mdi-cart-outline"></i> 
                                                </a>
                                                <a href="{{path('customer_delete', {'id':customer.id})}}" class="btn btn-danger btn-xs rounded" data-toggle="tooltip" data-placement="top" title="Delete Customer"><i class="fas fa-trash"></i> </a>
                                            
                                            </td>
                                            
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                            
                        </div>
                    </div>
                        
                    {% else %}
        
                    {% endif %}                                           
                    </div>        
                </div>
            </div>
        </div>
    </div>#}   
    
    <div class="row">
        <div class="col-lg-12 col-sm-12">
            <div class="card">
                <div class="card-body table-responsive">
                    <h5 class="header-title">Liste des {% if type == 'customer' %}Clients{% elseif type == 'supplier' %}Fournisseurs{% endif %}</h5>
                    <div class="mt-2 mb-2 mr-5 text-right">
                        <a href="{% if subIsActivated == true %}{{path('business_contact_create',{'type':type})}}{% else %}#{% endif %}"  class="btn btn-info btn-lg rounded waves-effect mr-2" data-toggle="tooltip" data-placement="top" title="Ajouter un nouveau {% if type == 'customer' %}Client{% elseif type == 'supplier' %}Fournisseur{% endif %}{% if subIsActivated == false %} Veuillez vous réabonner pour utiliser cette fonctionnalité{% endif %}"><i class="fa fa-plus-circle mr-2"></i> <i class="mdi mdi-account-multiple"></i></a>
                    </div>
                    <div class="table-responsive">
                        <table id="customer" class="table table-striped table-fixed nowrap" style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                            <thead>
                                <tr class="text-center">
                                    {# <th>#</th> #}
                                    <th>Nom</th>
                                    <th>Tél</th>
                                    <th class="d-none d-sm-table-cell">Adresse</th>
                                    <th class="d-none d-sm-table-cell">Infos suppl.</th>
                                    {# <th class="d-none d-sm-table-cell">{% if type == 'customer' %}Revenues Générés (XAF){% elseif type == 'supplier' %}Dépenses Générées (XAF){% endif %}</th>
                                    <th class="d-none d-sm-table-cell">{% if type == 'customer' %}Nombre de commande{% elseif type == 'supplier' %}Number of Purchase Orders{% endif %}</th>
                                    <th class="d-none d-sm-table-cell">{% if type == 'customer' %}Créances (XAF){% elseif type == 'supplier' %}Dettes (XAF){% endif %}</th> #}
                                    <th>Actions</th>
                                </tr>
                            </thead>

                            <tbody>
                                {% for businessContact in businessContacts %}
                                {% set rest = 0 %}
                                <tr class="text-center">
                                    {# <td>{{businessContact.id}}</td> #}
                                    <td class="text-left"><a href="{{path('business_contact_details', {'id':businessContact.id})}}"  class="" >{{businessContact.socialReason}}</a></td>
                                    <td>{{businessContact.phoneNumber }}</td>
                                    <td class="d-none d-sm-table-cell text-left">{{businessContact.address}}</td>
                                    <td class="d-none d-sm-table-cell text-left">{{businessContact.moreInfos}}</td>
                                    {# <td class="d-none d-sm-table-cell">
                                        {% if type == 'customer' %}
                                            {% set totalAmountBill = 0 %}
                                            {% for commercialSheet in businessContact.commercialSheets %}
                                                {% if commercialSheet.type == 'bill'  %}
                                                    {% if commercialSheet.deliveryStatus == true  or commercialSheet.completedStatus == true %}
                                                        {% set totalAmountBill = totalAmountBill + commercialSheet.amountNetToPaid %}
                                                    {% endif %}
                                                    {% set rest = rest + commercialSheet.amountRestToPaid %}
                                                {% endif %}
                                            {% endfor %}
                                        {{ totalAmountBill }}
                                        {% elseif type == 'supplier' %}
                                            {% set totalAmountPurchaseOrder = 0 %}
                                            {% for commercialSheet in businessContact.commercialSheets %}
                                                {% if commercialSheet.type == 'purchaseorder'%}
                                                    {% if commercialSheet.deliveryStatus == true  or commercialSheet.completedStatus == true %}
                                                        {% set totalAmountPurchaseOrder = totalAmountPurchaseOrder + commercialSheet.amountNetToPaid %}
                                                    {% endif %}
                                                    {% set rest = rest + commercialSheet.amountRestToPaid %}
                                                {% endif %}
                                            {% endfor %}
                                        {{ totalAmountPurchaseOrder }}
                                        {% endif %}
                                    </td>
                                    <td class="d-none d-sm-table-cell">
                                        {% if type == 'customer' %}
                                            {% set completedBill = [] %}
                                            {% for commercialSheet in businessContact.commercialSheets %}
                                                {% if commercialSheet.type == 'bill' and (commercialSheet.completedStatus == true or commercialSheet.deliveryStatus == true) %}
                                                    {% set completedBill = completedBill|merge([commercialSheet]) %}
                                                {% endif %}
                                            {% endfor %}
                                            
                                        {{ completedBill|length }}
                                        {% elseif type == 'supplier' %}
                                            {% set completedPurchaseOrder = [] %}
                                            {% for commercialSheet in businessContact.commercialSheets %}
                                                {% if commercialSheet.type == 'purchaseorder' and (commercialSheet.completedStatus == true or commercialSheet.deliveryStatus == true) %}
                                                    {% set completedPurchaseOrder = completedPurchaseOrder|merge([commercialSheet]) %}
                                                {% endif %}
                                            {% endfor %}
                                            
                                            {{ completedPurchaseOrder|length }}
                                        {% endif %}
                                    </td>
                                    <td class="d-none d-sm-table-cell">{{ rest }}</td> #}
                                    <td>
                                        <a href="{{path('business_contact_edit', {'id':businessContact.id})}}"  class="btn btn-info btn-xs rounded waves-effect mr-2" data-toggle="tooltip" data-placement="top" title="Modifiez le {% if type == 'customer' %}Client{% elseif type == 'supplier' %}Fournisseur{% endif %}"><i class="far fa-edit"></i> </a>
                                        {% if type == 'customer' %}
                                        <a href="{% if subIsActivated == true %}#custom-modal{{businessContact.id}}{% else %}#{% endif %}" class="btn btn-primary btn-xs rounded waves-effect mr-2" data-animation="corner" data-plugin="custommodal" data-overlayColor="#38414a" data-toggle="tooltip" data-placement="top" title="Editer un document ?{% if subIsActivated == false %} Veuillez vous réabonner pour utiliser cette fonctionnalité{% endif %}"><i class="mdi mdi-file-table-outline"></i></a>
                                        <!-- Custom Modal -->
                                        <div id="custom-modal{{businessContact.id}}" class="modal-demo">
                                            <button type="button" class="close" onclick="Custombox.modal.close();">
                                                <span>&times;</span><span class="sr-only">Close</span>
                                            </button>
                                            <h4 class="custom-modal-title">Choisir le type de document à créer</h4>
                                            <div class="custom-modal-text">
                                                {# <a href="{{ path('commercial_sheet_create', {'id':businessContact.id,'type':'quote'}) }}" class="btn btn-primary btn-lg rounded text-left">Quote</a> 
                                                <a href="{{ path('commercial_sheet_create', {'id':businessContact.id,'type':'bill'}) }}" class="btn btn-info btn-lg rounded float-right">Bill</a> #}
                                                
                                                <form class="form mb-2" role="form">
                                                    <div class="form-group mb-0 row">
                                                        <div class="col-12">
                                                            <div class="form-check-inline my-1">
                                                                <div class="custom-control custom-radio">
                                                                    <input class="custom-control-input" type="radio" id="inlineRadio1{{businessContact.id}}" value="quote" name="documentType{{businessContact.id}}">
                                                                    <label class="custom-control-label" for="inlineRadio1{{businessContact.id}}"> Devis </label>
                                                                    
                                                                </div>
                                                                
                                                            </div>
                                                            <div class="form-check-inline float-right my-1">
                                                                <div class="custom-control custom-radio">
                                                                    <input class="custom-control-input" type="radio" id="inlineRadio2{{businessContact.id}}" value="bill" name="documentType{{businessContact.id}}" checked="">
                                                                    <label class="custom-control-label" for="inlineRadio2{{businessContact.id}}"> Facture de vente </label>
                                                                    
                                                                </div>
                                                                
                                                            </div>
                                                            
                                                        </div>
                                                    </div>
                                                
                                                </form>
                                                
                                                {% if iconStock == true %}
                                                {% if inventories|length > 0 %}
                                                <div class="form-group row my-2 inventory-select ">
                                                    <label class="col-sm-4 col-form-label text-left mt-2">Choisir l'inventaire</label>
                                                    <div class="col-sm-8 mt-2">
                                                        <select class="custom-select" id="stockId{{businessContact.id}}">
                                                            {% for inventory in inventories %}
                                                            <option value="{{inventory.id}}" {% if loop.first %}selected=""{% endif %}>{{inventory.name}}</option>
                                                            {% endfor %}
                                                        </select>
                                                    </div>
                                                </div>
                                                {% endif %}
                                                {% endif %}

                                                <div class="row mx-2 float-right mb-2">
                                                    <button type="button" data-action="place" data-target="{{businessContact.id}}" class="btn btn-success btn-lg">
                                                        <span class="spinner-border spinner-border-sm mr-1 d-none" role="status" aria-hidden="true"></span>
                                                        OK
                                                    </button>
                                                </div>
                                            </div>
                                        </div> <!--end custom modal--> 
                                        {% elseif type == 'supplier' %}
                                        <a href="{% if subIsActivated == true %}{{ path('commercial_sheet_create', {'id':businessContact.id,'type':'purchaseorder'}) }}{% else %}#{% endif %}" class="btn btn-secondary btn-xs rounded text-right mr-2" data-toggle="tooltip" data-placement="top" title="Editer une facture d'achat ?{% if subIsActivated == false %} Veuillez vous réabonner pour utiliser cette fonctionnalité{% endif %}"><i class="mdi mdi-file-table-outline"></i></a>
                                        {% endif %}
                                        <a href="{{path('business_contact_delete', {'id':businessContact.id})}}" class="btn btn-danger btn-xs rounded" data-toggle="tooltip" data-placement="top" title="Supprimez {% if type == 'customer' %}Client{% elseif type == 'supplier' %}Fournisseur{% endif %}"><i class="fas fa-trash"></i> </a>
                                    
                                    </td>
                                    
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>           
                </div>
            </div>
        </div>
    </div><!--end row-->

{% endblock %}

{% block javascripts %}
<!-- Required datatable js -->
<script src="/plugins/datatables/jquery.dataTables.min.js"></script>
<script src="/plugins/datatables/dataTables.bootstrap4.min.js"></script>
<!-- Buttons examples -->
{# <script src="/plugins/datatables/dataTables.buttons.min.js"></script>
<script src="/plugins/datatables/buttons.bootstrap4.min.js"></script>
<script src="/plugins/datatables/jszip.min.js"></script>
<script src="/plugins/datatables/pdfmake.min.js"></script>
<script src="/plugins/datatables/vfs_fonts.js"></script>
<script src="/plugins/datatables/buttons.html5.min.js"></script>
<script src="/plugins/datatables/buttons.print.min.js"></script>
<script src="/plugins/datatables/buttons.colVis.min.js"></script> #}
<!-- Responsive examples -->
<script src="/plugins/datatables/dataTables.responsive.min.js"></script>
<script src="/plugins/datatables/responsive.bootstrap4.min.js"></script>

<script src="https://cdn.datatables.net/1.10.22/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/buttons/1.6.4/js/dataTables.buttons.min.js"></script>
<script src="/plugins/datatables/buttons.bootstrap4.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
<script src="https://cdn.datatables.net/buttons/1.6.4/js/buttons.html5.min.js"></script>
<script src="https://cdn.datatables.net/buttons/1.6.4/js/buttons.print.min.js"></script>
<script src="https://cdn.datatables.net/buttons/1.6.4/js/buttons.colVis.min.js"></script>
<!-- Responsive examples -->
<script src="https://cdn.datatables.net/1.10.22/js/dataTables.bootstrap4.min.js"></script>


<script src="/pages/jquery.datatable.init.js"></script>    

<script>
    {# var table = $('#datatable').DataTable( {
        orderCellsTop: true,
        fixedHeader: true
    } );
    // Setup - add a text input to each footer cell
    $('#datatable thead tr').clone(true).appendTo( '#datatable thead' );
    $('#datatable thead tr:eq(1) th').each( function (i) {
        var title = $(this).text();
        $(this).html( '<input type="text" placeholder="Search '+ title + '" />' );
 
        $( 'input', this ).on( 'keyup change', function () {
            if ( table.column(i).search() !== this.value ) {
                table
                    .column(i)
                    .search( this.value )
                    .draw();
            }
        } );
    } ); #}
 
    {# $("input:radio").change(function(){
        //console.log('input radio change');
        //var type = $(this).val();
        if(type === 'quote'){
            $('.inventory-select').addClass('d-none');
        }
        else $('.inventory-select').removeClass('d-none'); 
    }); #}

//$('.inventory-select').addClass('d-none');
    var now = new Date();
    var jsDate = now.getDate()+'-'+(now.getMonth()+1)+'-'+now.getFullYear();
    var customerFileName = 'Liste des {% if type == 'customer' %}Clients{% elseif type == 'supplier' %}Fournisseurs{% endif %} | Date : ' + jsDate.toString();
    {# var demandFileName = 'Demande Réapprivisionnement | Stock de {{ (app.user.enterprise.socialReason)|capitalize }} | Date ' + jsDate.toString(); #}
    console.log(customerFileName);
    var customerTable = $('#customer').DataTable({
        //dom: 'Bfrtip',
        lengthChange: true,
        lengthMenu: [ 10, 25, 50, 100, 200 ],
        pageLength: 10,
        buttons: [
            {
                text: 'Exporter PDF',
                extend: 'pdfHtml5',
                filename: customerFileName,
                exportOptions: {
                    columns: [ 0, 1, 2, 3 ],
                    //columns: ':visible'
                    search: 'applied',
                    order: 'applied'
                },
                title: function( thead, data, start, end, display ) {
                    return "{{app.user.enterprise.socialReason}}\r\n" + customerFileName;
                },
                customize: function (doc) {
                    //Remove the title created by datatTables
                    {# {% if app.user.enterprise.logo != null %}
                    var logo = getBase64FromImageUrl("{{ '/images/uploads/logo/' ~ app.user.enterprise.logo }}");
                    {% endif %}
                    //doc.content.splice(0,1);
                    doc.content.splice( 1, 0, {
                        margin: [ 0, 0, 0, 12 ],
                        alignment: 'center',
                        {% if app.user.enterprise.logo != null %}image: logo{% endif %}
                    } ); #}
                    //Create a date string that we use in the footer. Format is dd-mm-yyyy
                    var now = new Date();
                    var jsDate = now.getDate()+'-'+(now.getMonth()+1)+'-'+now.getFullYear();
                    // Logo converted to base64
                    // var logo = getBase64FromImageUrl('https://datatables.net/media/images/logo.png');
                    // The above call should work, but not when called from codepen.io
                    // So we use a online converter and paste the string in.
                    // Done on http://codebeautify.org/image-to-base64-converter
                    // It's a LONG string scroll down to see the rest of the code !!!
                    //var logo = 'data:image/jpeg;base64,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ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA=';
                    // A documentation reference can be found at
                    // https://github.com/bpampuch/pdfmake#getting-started
                    // Set page margins [left,top,right,bottom] or [horizontal,vertical]
                    // or one number for equal spread
                    // It's important to create enough space at the top for a header !!!
                    doc.pageMargins = [60,60,60,30];
                    // Set the font size fot the entire document
                    doc.defaultStyle.fontSize = 12;
                    // Set the fontsize for the table header
                    doc.styles.tableHeader.fontSize = 13;
                    //doc.styles.tableBodyOdd.fillColor = "yellow";
                    doc.styles.tableBodyOdd.alignment = function (rowIndex, node, columnIndex) {
                                                    return (rowIndex >= 0) ? 'center' : null;
                                                };
                    doc.styles.tableHeader.fillColor = "#6c757d";
                    console.log(doc);
                    var objTable = {};
                    //objTable['heights'] = (function(i) { return 100; });
                    //objTable['widths'] = ['*', 'auto', '*', 'auto', 'auto', 'auto'];
                    //objTable['widths']   = (function(i) { return ['*', 'auto', '*', 'auto', 'auto', 'auto']; });
                    //doc.content[1].table = objTable; 
                    doc.content[1].table.widths = ['auto', '*', 'auto', '*']; 
                    //doc.content[1].table.heights = (function(i) { return 100; }); 
                    doc.content[1].layout = {
                                                fillColor: function (rowIndex, node, columnIndex) {
                                                    return (rowIndex % 2 === 0) ? '#CCCCCC' : null;
                                                }
                                            }; 
                        
                    // Create a header object with 3 columns
                    // Left side: Logo
                    // Middle: brandname
                    // Right side: A document title
                    /*doc['header']=(function() {
                        return {
                            columns: [
                                {
                                    //image: logo,
                                    "width": 24
                                },
                                {
                                    alignment: 'left',
                                    italics: true,
                                    text: 'dataTables',
                                    fontSize: 18,
                                    margin: [10,0]
                                },
                                {
                                    alignment: 'right',
                                    fontSize: 14,
                                    text: 'Custom PDF export with dataTables'
                                }
                            ],
                            margin: 20
                        }
                    });*/
                    // Create a footer object with 2 columns
                    // Left side: report creation date
                    // Right side: current page and total pages
                    doc['footer']=(function(page, pages) {
                        return {
                            columns: [
                                {
                                    alignment: 'left',
                                    text: ['Crée le : ', { text: jsDate.toString() }]
                                },
                                {
                                    alignment: 'center',
                                    text: ['{{app.user.enterprise.socialReason}} {% if app.user.enterprise.niu is not empty %}- NIU : {{app.user.enterprise.niu}} {% endif %} {% if app.user.enterprise.rccm is not empty %}- RCCM : {{app.user.enterprise.rccm}}{% endif %}']
                                },
                                {
                                    alignment: 'right',
                                    text: ['page ', { text: page.toString() },	' de ',	{ text: pages.toString() }]
                                }
                            ],
                            margin: 20
                        }
                    });
                    // Change dataTable layout (Table styling)
                    // To use predefined layouts uncomment the line below and comment the custom lines below
                    // doc.content[0].layout = 'lightHorizontalLines'; // noBorders , headerLineOnly
                    var objLayout = {};
                    objLayout['hLineWidth']   = (function(i) { return .5; });
                    objLayout['vLineWidth']   = (function(i) { return .5; });
                    objLayout['hLineColor']   = (function(i) { return '#ccc'; });
                    objLayout['vLineColor']   = (function(i) { return '#ccc'; });
                    objLayout['paddingLeft']  = (function(i) { return 4; });
                    objLayout['paddingRight'] = (function(i) { return 4; });
                    doc.content[0].layout = objLayout;
                } 
            } 
            //'colvis'
            ],
    });

    customerTable.buttons().container()
        .appendTo('#customer_wrapper .col-md-6:eq(0)');
    
    $('.buttons-pdf').children('span').prepend('<i class="mdi mdi-download mr-2"></i>');

    $('button[data-action="place"]').click(function(){
        //console.log('OK Btn clicked');
        //block of code that runs when the click event triggers
        var id_ = this.dataset.target;//BC id
        var type;
        var documentType = "input:checkbox[name=documentType" + id_ + "]:checked";
        console.log('documentType = ' + documentType);
        $("input:radio[name=documentType" + id_ + "]:checked").each(function(){
            type = $(this).val();
        });
        //console.log('Type = ' + type);
        {% if iconStock == true and inventories|length > 0 %}
        var stockId = '#stockId' + id_;
        var stock = $(stockId).val();
        var _url = "/commercial/sheet/new/" + id_ + "/" + type + "/" + stock;
        {% else %}
        var _url = "/commercial/sheet/new/" + id_ + "/" + type;
        {% endif %}
        //console.log('Url = ' + _url);
        
        window.location.replace(_url);

        $(this).children('i').addClass('d-none');
        $(this).children('span').removeClass('d-none');
    }); 
</script>
{% endblock %}